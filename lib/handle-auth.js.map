{"version":3,"sources":["lib/handle-auth.es6"],"names":[],"mappings":";;;;;;;;;;;;;oBAUwB,UAAU;;AAAnB,YAAS,UAAU,CAAE,QAAQ,EAAE,QAAQ,EAAE,IAAI,EAAG;AAC5D,UAAM,OAAO,GAAG,QAAQ,CAAE,IAAI,CAAE,CAAC;AACjC,UAAM,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC;AAClC,UAAM,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC;;AAE1B,aAAO,IAAI,OAAO,CAAE,UAAU,OAAO,EAAE,MAAM,EAAG;AAC7C,aAAI,IAAI,GAAG,EAAE,CAAC;AACd,aAAI,KAAK,GAAG,CAAC,IAAI,CAAC;;AAElB,aAAI,CAAC,QAAQ,IAAI,CAAC,IAAI,EAAG;AACtB,mBAAO,OAAO,CAAE,IAAI,CAAE,CAAC;UACzB;;AAED,aAAI,QAAQ,EAAG;AACZ,oBAAQ,CAAC,SAAS,CAAE,aAAa,GAAG,QAAQ,EAAE,UAAU,KAAK,EAAG;AAC7D,mBAAI,GAAG,KAAK,CAAC,IAAI,CAAC;AAClB,mBAAI,KAAK,EAAG;AACT,yBAAO,CAAE,IAAI,CAAE,CAAC;gBAClB;aACH,CAAE,CAAC;UACN;;AAED,aAAI,IAAI,EAAG;AACR,oBAAQ,CAAC,SAAS,CAAE,gBAAgB,GAAG,IAAI,EAAE,UAAU,KAAK,EAAG;AAC5D,oBAAK,GAAG,KAAK,CAAC,KAAK,CAAC;AACpB,mBAAI,CAAC,KAAK,EAAG;AACV,wBAAM,CAAE,IAAI,CAAE,CAAC;gBACjB,MAAM,IAAI,IAAI,EAAG;AACf,yBAAO,CAAE,IAAI,CAAE,CAAC;gBAClB;aACH,CAAE,CAAC;UACN;OACH,CAAE,CAAC;IACN","file":"lib/handle-auth.es6","sourcesContent":["/**\n * Copyright 2015 aixigo AG\n * Released under the MIT license.\n * http://laxarjs.org\n */\n\n/**\n * Wait for authentication and resolve the returned promise once the user\n * is authenticated.\n */\nexport default function handleAuth( eventBus, features, name ) {\n   const feature = features[ name ];\n   const resource = feature.resource;\n   const flag = feature.flag;\n\n   return new Promise( function( resolve, reject ) {\n      var data = {};\n      var state = !flag;\n\n      if( !resource && !flag ) {\n         return resolve( data );\n      }\n\n      if( resource ) {\n         eventBus.subscribe( 'didReplace.' + resource, function( event ) {\n            data = event.data;\n            if( state ) {\n               resolve( data );\n            }\n         } );\n      }\n\n      if( flag ) {\n         eventBus.subscribe( 'didChangeFlag.' + flag, function( event ) {\n            state = event.state;\n            if( !state ) {\n               reject( data );\n            } else if( data ) {\n               resolve( data );\n            }\n         } );\n      }\n   } );\n}\n"]}